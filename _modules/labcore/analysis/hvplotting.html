
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" data-theme="auto">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>labcore.analysis.hvplotting &#8212; Labcore  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "auto";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "auto";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8f2a1f02" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/labcore/analysis/hvplotting';</script>
    <link rel="canonical" href="https://toolsforexperiments.github.io/labcore/_modules/labcore/analysis/hvplotting.html" />
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="auto">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo.png" class="logo__image only-light" alt=""/>
    <img src="../../../_static/logo.png" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">Labcore</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../first_steps/index.html">
    First Steps
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../examples/index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://toolsforexperiments.github.io/">
    Tools for Experiments
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://toolsforexperiments.github.io/instrumentserver/">
    Instrumentserver
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://toolsforexperiments.github.io/plottr/">
    Plottr
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/toolsforexperiments/labcore" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../first_steps/index.html">
    First Steps
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../examples/index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://toolsforexperiments.github.io/">
    Tools for Experiments
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://toolsforexperiments.github.io/instrumentserver/">
    Instrumentserver
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://toolsforexperiments.github.io/plottr/">
    Plottr
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/toolsforexperiments/labcore" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">labcore.analysis.hvplotting</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for labcore.analysis.hvplotting</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;HoloViews-based plotting for labstack.</span>
<span class="sd">Contains a set of classes and functions that can be used to plot labstack-style data.</span>

<span class="sd">Important Classes:</span>
<span class="sd">    - Nodes:</span>
<span class="sd">        - Node: a base class for all nodes. Nodes are the basic blocks we use for</span>
<span class="sd">            processing data. They can be chained together to form a pipeline.</span>
<span class="sd">        - LoaderNode: a node that loads and preprocesses data.</span>
<span class="sd">        - ReduxNode: a node that reduces data dimensionality (e.g. by averaging).</span>
<span class="sd">        - ValuePlot: plots data values.</span>
<span class="sd">        - ComplexHist: plots histograms of complex data (&#39;IQ readout histograms&#39;).</span>

<span class="sd">    - Widgets:</span>
<span class="sd">        - XYSelect: a widget for selecting x and y axes.</span>


<span class="sd">#TODO:</span>

<span class="sd">    * When fitting real and imaginary data, the color of the dot and line between data crosses. For example if the imaginary line is red with dots red, after adding a fit to the real data, the dots of imaginary will remain red, but the lines will be orange and the dots of the fit will orange but the lines red</span>
<span class="sd">    * Program refuses to open if it cannot find the config file.</span>
<span class="sd">    * Program refuses to open if it cannot find data properly formatted. This might be ok but a nice error message should appear.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">importlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">panel</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">param</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ruamel.yaml</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">panel.widgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">RadioButtonGroup</span> <span class="k">as</span> <span class="n">RBG</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">..data.datadict_storage</span><span class="w"> </span><span class="kn">import</span> <span class="n">NumpyEncoder</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..data.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">data_dims</span><span class="p">,</span> <span class="n">split_complex</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..utils.misc</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_end_number_to_repeated_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.fit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Fit</span><span class="p">,</span> <span class="n">FitResult</span><span class="p">,</span> <span class="n">plot_ds_2d_with_fit</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">pn</span><span class="o">.</span><span class="n">extension</span><span class="p">(</span><span class="n">notifications</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">Data</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span>
<span class="sd">&quot;&quot;&quot;Type alias for valid data. Can be either a pandas DataFrame or an xarray Dataset.&quot;&quot;&quot;</span>

<span class="n">DataDisplay</span> <span class="o">=</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">pn</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span>
<span class="sd">&quot;&quot;&quot;Type alias for displaying raw data.&quot;&quot;&quot;</span>


<div class="viewcode-block" id="Node">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.Node">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Node</span><span class="p">(</span><span class="n">pn</span><span class="o">.</span><span class="n">viewable</span><span class="o">.</span><span class="n">Viewer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Node base class.</span>

<span class="sd">    A simple wrapper class that we use to standardize the way we process data.</span>
<span class="sd">    Aim: whenever input data is set/updated, ``Node.process`` is called (in the</span>
<span class="sd">    base class it simply sets output equal to input).</span>
<span class="sd">    User-defined nodes may watch ``data_in`` and ``data_out`` to update UI or</span>
<span class="sd">    anything else.</span>
<span class="sd">    Pipelines are formed by appending nodes to each other using ``Node.append``.</span>

<span class="sd">    Nodes with graphs must implement a ``get_plot()`` function that returns</span>
<span class="sd">    a holoviews graph object in order for that graph to be able to be saved</span>
<span class="sd">    as either an html or png file.</span>

<span class="sd">    Params</span>
<span class="sd">    ------</span>
<span class="sd">    data_in</span>
<span class="sd">        input data. Must be either a pandas DataFrame or an xarray Dataset.</span>
<span class="sd">    data_out</span>
<span class="sd">        processed output data. Must be either a pandas DataFrame or an xarray Dataset.</span>
<span class="sd">    units_in</span>
<span class="sd">        units of input data. Must be a dictionary with keys corresponding to dimensions,</span>
<span class="sd">        and values corresponding to units.</span>
<span class="sd">    units_out</span>
<span class="sd">        units of output data. Must be a dictionary with keys corresponding to dimensions,</span>
<span class="sd">        and values corresponding to units.</span>
<span class="sd">    meta_in</span>
<span class="sd">        any input metadata. Arbitrary keys/value.</span>
<span class="sd">    meta_out</span>
<span class="sd">        any output metadata. Arbitrary keys/value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data_in</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">data_out</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># -- important metadata</span>
    <span class="n">units_in</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Parameter</span><span class="p">({})</span>
    <span class="n">units_out</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Parameter</span><span class="p">({})</span>
    <span class="n">meta_in</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Parameter</span><span class="p">({})</span>
    <span class="n">meta_out</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Parameter</span><span class="p">({})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__panel__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">viewable</span><span class="o">.</span><span class="n">Viewable</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_in</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Data</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for ``Node``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_in</span>
<span class="sd">            Optional input data.</span>
<span class="sd">        *args:</span>
<span class="sd">            passed to ``pn.viewable.Viewer``.</span>
<span class="sd">        **kwargs:</span>
<span class="sd">            passed to ``pn.viewable.Viewer``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_watchers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Node</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">parameterized</span><span class="o">.</span><span class="n">Watcher</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Column</span><span class="p">()</span>

        <span class="c1"># -- options for plotting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph_types</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;None&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="n">ValuePlot</span><span class="p">,</span>
                            <span class="s2">&quot;Readout hist.&quot;</span><span class="p">:</span> <span class="n">ComplexHist</span><span class="p">,</span>
                            <span class="s2">&quot;Magnitude &amp; Phase&quot;</span><span class="p">:</span> <span class="n">MagnitudePhasePlot</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_select</span> <span class="o">=</span> <span class="n">RBG</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_types</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;View as&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Node</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">data_in</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span> <span class="o">=</span> <span class="n">data_in</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>

        <span class="c1"># file_path is needed here so it can be passed to plots for fit saving</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">path</span>

<div class="viewcode-block" id="Node.render_data">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.Node.render_data">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">render_data</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Data</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DataDisplay</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shows data as renderable object.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        NotImplementedError</span>
<span class="sd">            if data is not a pandas DataFrame or an xarray Dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No data&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">max_rows</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">show_dimensions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="Node.data_dims">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.Node.data_dims">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">data_dims</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Data</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the dimensions of the data.</span>

<span class="sd">        Format: (independents, dependents); both as lists of strings.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        NotImplementedError</span>
<span class="sd">            if data is not a pandas DataFrame or an xarray Dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">data_dims</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>


<div class="viewcode-block" id="Node.mean">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.Node.mean">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Data</span><span class="p">,</span> <span class="o">*</span><span class="n">dims</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Takes the mean of data along the given dimensions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data</span>
<span class="sd">            input data.</span>
<span class="sd">        *dims</span>
<span class="sd">            dimensions to take the mean along</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data after taking the mean</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        NotImplementedError</span>
<span class="sd">            if data is not a pandas DataFrame or an xarray Dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indep</span><span class="p">,</span> <span class="n">dep</span> <span class="o">=</span> <span class="n">Node</span><span class="o">.</span><span class="n">data_dims</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">indep</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="n">indep</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">indep</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="Node.split_complex">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.Node.split_complex">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">split_complex</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Split complex dependents into real and imaginary parts.</span>

<span class="sd">        TODO: should update units as well</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data</span>
<span class="sd">            input data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data with complex dependents split into real and imaginary parts.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        NotImplementedError</span>
<span class="sd">            if data is not a pandas DataFrame or an xarray Dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">split_complex</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>


<div class="viewcode-block" id="Node.complex_dependents">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.Node.complex_dependents">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">complex_dependents</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Data</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a dictionary of complex dependents and their real/imaginary parts.</span>

<span class="sd">        Requires that complex data has already been split.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data</span>
<span class="sd">            input data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dictionary of the form:</span>
<span class="sd">            &quot;`dependent`&quot;: {&quot;real&quot;: &quot;`dependent_Re`&quot;, &quot;imag&quot;: &quot;`dependent_Im`&quot;}}</span>
<span class="sd">            `dependent_Re` and `dependent_Im` are the dimensions actually present</span>
<span class="sd">            in the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">dep</span> <span class="o">=</span> <span class="n">Node</span><span class="o">.</span><span class="n">data_dims</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dep</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;_Re&quot;</span><span class="p">:</span>
                <span class="n">im_dep</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_Im&quot;</span>
                <span class="k">if</span> <span class="n">im_dep</span> <span class="ow">in</span> <span class="n">dep</span><span class="p">:</span>
                    <span class="n">ret</span><span class="p">[</span><span class="n">d</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">real</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">imag</span><span class="o">=</span><span class="n">im_dep</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="Node.dim_label">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.Node.dim_label">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dim_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">which</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;out&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate dimension label for use in plots.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dim</span>
<span class="sd">            dimension name.</span>
<span class="sd">        which</span>
<span class="sd">            Either &quot;in&quot; or &quot;out&quot;, depending on whether we want the input or</span>
<span class="sd">            output data of the Node. Default is &quot;out&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dimension label, including units if available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s2">&quot;out&quot;</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units_out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units_in</span>

        <span class="k">if</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">units</span> <span class="ow">and</span> <span class="n">units</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">units</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2"> (a.u.)&quot;</span></div>


<div class="viewcode-block" id="Node.dim_labels">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.Node.dim_labels">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dim_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">which</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;out&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate dimension labels for use in plots.</span>

<span class="sd">        Generates all dimension labels for the data.</span>
<span class="sd">        See ``Node.dim_label`` for more information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s2">&quot;out&quot;</span><span class="p">:</span>
            <span class="n">indep</span><span class="p">,</span> <span class="n">dep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indep</span><span class="p">,</span> <span class="n">dep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="p">)</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="n">indep</span> <span class="o">+</span> <span class="n">dep</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">d</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="n">which</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">}</span></div>


<div class="viewcode-block" id="Node.update">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.Node.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">events</span><span class="p">:</span> <span class="n">param</span><span class="o">.</span><span class="n">parameterized</span><span class="o">.</span><span class="n">Event</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the node using external events.</span>

<span class="sd">        If event contains ``data_out``, ``units_out``, or ``meta_out``,</span>
<span class="sd">        will set them as ``data_in``, ``units_in``, or ``meta_in`` respectively.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;data_out&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">new</span>
            <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;units_out&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">units_in</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">new</span>
            <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;meta_out&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta_in</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">new</span></div>


<div class="viewcode-block" id="Node.process">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.Node.process">[docs]</a>
    <span class="nd">@pn</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;data_in&quot;</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process data.</span>

<span class="sd">        By default, simply sets ``data_out`` equal to ``data_in``.</span>

<span class="sd">        Can/Should be overridden by subclasses to do more complicated things.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span></div>


<div class="viewcode-block" id="Node.data_in_view">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.Node.data_in_view">[docs]</a>
    <span class="nd">@pn</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;data_in&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">data_in_view</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataDisplay</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updating view of input data (as table; as provided by the data type).</span>

<span class="sd">        Updates on change of ``data_in``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="p">)</span></div>


<div class="viewcode-block" id="Node.data_out_view">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.Node.data_out_view">[docs]</a>
    <span class="nd">@pn</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;data_out&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">data_out_view</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataDisplay</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updating view of output data (as table; as provided by the data type).</span>

<span class="sd">        Updates on change of ``data_out``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span></div>


<div class="viewcode-block" id="Node.plot">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.Node.plot">[docs]</a>
    <span class="nd">@pn</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;data_out&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">viewable</span><span class="o">.</span><span class="n">Viewable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A reactive panel object that allows selecting a plot type, and shows the plot.</span>

<span class="sd">        Updates on change of ``data_out``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">labeled_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_type_select</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="p">]</span></div>


<div class="viewcode-block" id="Node.plot_obj">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.Node.plot_obj">[docs]</a>
    <span class="nd">@pn</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;data_out&quot;</span><span class="p">,</span> <span class="s2">&quot;plot_type_select.value&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Node&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The actual plot object.</span>

<span class="sd">        Updates on change of ``data_out`` or the selection of the plot value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A dedicated plotting node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_select</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;Value&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span><span class="p">,</span> <span class="n">ValuePlot</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span> <span class="o">=</span> <span class="n">ValuePlot</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="n">data_in</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span><span class="o">.</span><span class="n">data_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_select</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;Magnitude &amp; Phase&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span><span class="p">,</span> <span class="n">MagnitudePhasePlot</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span> <span class="o">=</span> <span class="n">MagnitudePhasePlot</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="n">data_in</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span><span class="o">.</span><span class="n">data_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_select</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;Readout hist.&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span><span class="p">,</span> <span class="n">ComplexHist</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span> <span class="o">=</span> <span class="n">ComplexHist</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="n">data_in</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span><span class="o">.</span><span class="n">data_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out_view</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span></div>


<div class="viewcode-block" id="Node.append">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.Node.append">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Node&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">watcher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">watch</span><span class="p">(</span>
            <span class="n">other</span><span class="o">.</span><span class="n">update</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;data_out&quot;</span><span class="p">,</span> <span class="s2">&quot;units_out&quot;</span><span class="p">,</span> <span class="s2">&quot;meta_out&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_watchers</span><span class="p">[</span><span class="n">other</span><span class="p">]</span> <span class="o">=</span> <span class="n">watcher</span></div>


<div class="viewcode-block" id="Node.detach">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.Node.detach">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">detach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Node&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">other</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_watchers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">unwatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_watchers</span><span class="p">[</span><span class="n">other</span><span class="p">])</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_watchers</span><span class="p">[</span><span class="n">other</span><span class="p">]</span></div>


<div class="viewcode-block" id="Node.fit_obj">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.Node.fit_obj">[docs]</a>
    <span class="nd">@pn</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;data_out&quot;</span><span class="p">,</span> <span class="s2">&quot;plot_type_select.value&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Returns the panel to select fit variables</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span><span class="p">,</span> <span class="n">PlotNode</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_obj</span><span class="o">.</span><span class="n">get_fit_panel</span>
        <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">Column</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="ReduxNode">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.ReduxNode">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ReduxNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="n">OPTS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">]</span>

    <span class="n">coordinates</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[])</span>
    <span class="n">operations</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[])</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_widgets</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Column</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__panel__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span>

<div class="viewcode-block" id="ReduxNode.on_input_update">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.ReduxNode.on_input_update">[docs]</a>
    <span class="nd">@pn</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;data_in&quot;</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_input_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="o">.</span><span class="n">dims</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_widgets</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">RBG</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">OPTS</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">OPTS</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">ui</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ui</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_widgets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;widget&quot;</span><span class="p">:</span> <span class="n">w</span><span class="p">,</span>
                    <span class="s2">&quot;ui&quot;</span><span class="p">:</span> <span class="n">ui</span><span class="p">,</span>
                    <span class="s2">&quot;change_cb&quot;</span><span class="p">:</span> <span class="n">w</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">watch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_widget_change</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]),</span>
                <span class="p">}</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_widgets</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_widgets</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="s2">&quot;ui&quot;</span><span class="p">])</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_widgets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">on_widget_change</span><span class="p">()</span></div>


<div class="viewcode-block" id="ReduxNode.on_operations_change">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.ReduxNode.on_operations_change">[docs]</a>
    <span class="nd">@pn</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;operations&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_operations_change</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">operations</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_widgets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">o</span></div>


<div class="viewcode-block" id="ReduxNode.on_widget_change">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.ReduxNode.on_widget_change">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_widget_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">events</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operations</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_widgets</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                           <span class="p">[</span><span class="s2">&quot;widget&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">]</span></div>


<div class="viewcode-block" id="ReduxNode.process">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.ReduxNode.process">[docs]</a>
    <span class="nd">@pn</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;data_in&quot;</span><span class="p">,</span> <span class="s2">&quot;operations&quot;</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">operations</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">o</span> <span class="o">==</span> <span class="s2">&quot;Mean&quot;</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span> <span class="o">=</span> <span class="n">out</span></div>
</div>



<div class="viewcode-block" id="XYSelect">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.XYSelect">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">XYSelect</span><span class="p">(</span><span class="n">pn</span><span class="o">.</span><span class="n">viewable</span><span class="o">.</span><span class="n">Viewer</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Tuple</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="s2">&quot;None&quot;</span><span class="p">))</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;None&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xrbg</span> <span class="o">=</span> <span class="n">RBG</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_yrbg</span> <span class="o">=</span> <span class="n">RBG</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
            <span class="n">labeled_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xrbg</span><span class="p">),</span>
            <span class="n">labeled_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_yrbg</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_x</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_y</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__panel__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span>

<div class="viewcode-block" id="XYSelect.on_option_change">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.XYSelect.on_option_change">[docs]</a>
    <span class="nd">@param</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_option_change</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xrbg</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_yrbg</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span></div>


    <span class="nd">@param</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_sync_widgets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;None&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xrbg</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xrbg</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_yrbg</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@param</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;_xrbg.value&quot;</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_sync_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xrbg</span><span class="o">.</span><span class="n">value</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="nd">@param</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;_yrbg.value&quot;</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_sync_y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yrbg</span><span class="o">.</span><span class="n">value</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></div>



<span class="c1"># -- generic plot functions</span>

<div class="viewcode-block" id="PlotNode">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PlotNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;PlotNode, Node subclass</span>

<span class="sd">    A superclass of all nodes that make plots of some sort. Mostly</span>
<span class="sd">    deals with define/creating fits for whatever graph subnode is instantiated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">refresh_graph</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">FITS</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="PlotNode.load_fits_from_config">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.load_fits_from_config">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_fits_from_config</span><span class="p">():</span>
        <span class="n">PlotNode</span><span class="o">.</span><span class="n">FITS</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">yaml</span> <span class="o">=</span> <span class="n">ruamel</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">YAML</span><span class="p">()</span>
        <span class="n">cwd</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">cwd</span> <span class="o">/</span> <span class="s2">&quot;autoplotConfig.yml&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">config_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Could not find config file at </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">. Please add a file called `autoplotConfig.yml` wherever you are running autoplot.&quot;</span>
            <span class="p">)</span>
        <span class="n">raw_config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span>
        <span class="c1"># Add fits to PlotNode.FITS if fits in the Config</span>
        <span class="k">if</span> <span class="s1">&#39;fits&#39;</span> <span class="ow">in</span> <span class="n">raw_config</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">raw_config</span><span class="p">[</span><span class="s1">&#39;fits&#39;</span><span class="p">]:</span>
                <span class="c1"># Module and Class name from the string</span>
                <span class="n">modname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">mod</span> <span class="o">=</span> <span class="n">modname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">modname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="c1"># Add to FITS</span>
                    <span class="n">PlotNode</span><span class="o">.</span><span class="n">FITS</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Could not access Class </span><span class="si">{</span><span class="n">modname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> from module </span><span class="si">{</span><span class="n">modname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">. Exception: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>

        <span class="k">if</span> <span class="n">PlotNode</span><span class="o">.</span><span class="n">FITS</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_fits_from_config</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Create fit_dict from json based on path</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span> <span class="ow">or</span> <span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_data_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_data_path</span> <span class="o">=</span> <span class="n">_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;fit_data.json&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fit_result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Initialize _fit_axis_options to avoid errors when there&#39;s no data.</span>
        <span class="c1"># This should get properly set in the process() function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_axis_options</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Initialize fit layout variables so they can be checked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_inputs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_fit_button</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reguess_fit_button</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_fit_button</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refit_button</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_box</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># A toggle variable to refresh the graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_graph</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">fit_options</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">PlotNode</span><span class="o">.</span><span class="n">FITS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">fit_options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">MenuButton</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Fit&quot;</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="n">fit_options</span><span class="p">,</span> <span class="n">button_type</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">100</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_fit_box</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Fit Axis&#39;</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_axis_options</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_axis_options</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">watch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_fit_box</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fit_layout</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
            <span class="n">pn</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="p">),</span>
        <span class="p">)</span>

<div class="viewcode-block" id="PlotNode.get_fit_panel">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.get_fit_panel">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_fit_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_layout</span></div>

    
<div class="viewcode-block" id="PlotNode.process">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.process">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a copy of the data so that changes (added fits) don&#39;t carry</span>
<span class="sd">        to other graphs/other analysis.</span>
<span class="sd">        Add saved arguments for all fits/axes.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="p">)</span>
        <span class="c1"># Set fit_axis_options based on the function. Default to [] if returns None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_axis_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_axis_options</span><span class="p">()</span>
        <span class="c1"># Draw any fits that already exist</span>
        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_axis_options</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">axis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">func_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;fit_function&#39;</span><span class="p">]</span>
                <span class="n">saved_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">func_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PlotNode</span><span class="o">.</span><span class="n">FITS</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Axis </span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s2"> has a fit of type </span><span class="si">{</span><span class="n">func_name</span><span class="si">}</span><span class="s2"> saved, which you don&#39;t have access to.&quot;</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="n">pn</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_dataset_by_fit_and_axis</span><span class="p">(</span><span class="n">PlotNode</span><span class="o">.</span><span class="n">FITS</span><span class="p">[</span><span class="n">func_name</span><span class="p">],</span> <span class="n">saved_args</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotNode.plot_panel">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.plot_panel">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates and returns a panel with the class&#39;s plot</span>

<span class="sd">        Should be overridden by subclasses to return the desired plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="PlotNode.get_plot">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.get_plot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the plot as a holoviews object</span>

<span class="sd">        Used for saving the plot as html or png.</span>

<span class="sd">        Can/Should be overridden by subclasses to return the appropriate object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_panel</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotNode.fit_axis_options">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.fit_axis_options">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit_axis_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of the different axes you can </span>
<span class="sd">        make a fit for in this node.</span>

<span class="sd">        Should be overridden by subclasses to return the appropriate object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="PlotNode.set_fit_box">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.set_fit_box">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_fit_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">events</span><span class="p">:</span> <span class="n">param</span><span class="o">.</span><span class="n">parameterized</span><span class="o">.</span><span class="n">Event</span><span class="p">,</span> <span class="n">fitted</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fitted</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fitted</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="s1">&#39;start_params&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">fitted</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Delete start parameters when refreshing the fit box. Creating the </span>
        <span class="c1"># fit box will regenerate these.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;start_params&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span><span class="p">][</span><span class="s1">&#39;start_params&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_fit_box_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="o">.</span><span class="n">clicked</span> <span class="o">!=</span>
                                <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="n">fitted</span><span class="o">=</span><span class="n">fitted</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotNode.set_fit_box_helper">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.set_fit_box_helper">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_fit_box_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_box</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">fit_func_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fitted</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes and/or creates a fit box. If new_box == True this</span>
<span class="sd">        will (re)create the fit box.&quot;&quot;&quot;</span>
        <span class="c1"># Check if fit_box exists &amp; get fit_box</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_box</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">new_box</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_fit_box</span><span class="p">(</span><span class="n">fit_func_name</span><span class="p">,</span> <span class="n">fitted</span><span class="o">=</span><span class="n">fitted</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_fit_box</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">new_box</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_fit_box</span><span class="p">(</span><span class="n">fit_func_name</span><span class="p">,</span> <span class="n">fitted</span><span class="o">=</span><span class="n">fitted</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotNode.remove_fit_box">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.remove_fit_box">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_fit_box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fit_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_layout</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_layout</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Get all fit objects other than layout and set as the current objects</span>
        <span class="n">no_fit_objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_layout</span><span class="o">.</span><span class="n">objects</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_layout</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">no_fit_objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_inputs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_fit_button</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_box</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="PlotNode.add_fit_box">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.add_fit_box">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_fit_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selected</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fitted</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a widget box for creating a fit.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">selected</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="o">.</span><span class="n">clicked</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span><span class="p">][</span><span class="s1">&#39;fit_function&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">selected</span><span class="p">:</span>
                <span class="n">fitted</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Create a widget box, add the name of the fit function at top</span>
        <span class="n">objs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pn</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;FITTED&#39;</span> <span class="k">if</span> <span class="n">fitted</span> <span class="k">else</span> <span class="s1">&#39;Setup&#39;</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">selected</span><span class="p">,</span>
            <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="p">)]</span>
        <span class="n">fit_class</span> <span class="o">=</span> <span class="n">PlotNode</span><span class="o">.</span><span class="n">FITS</span><span class="p">[</span><span class="n">selected</span><span class="p">]</span>
        <span class="c1"># Get guesses or saved values for all variables and make inputs</span>
        <span class="n">saved_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_arguments</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">fit_class</span><span class="o">.</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">var</span> <span class="o">==</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">:</span>
                <span class="c1"># User wont input coords</span>
                <span class="k">continue</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">var</span>
            <span class="k">if</span> <span class="n">fitted</span><span class="p">:</span>
                <span class="n">objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">pn</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">var</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">saved_args</span><span class="p">[</span><span class="n">var</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; +/- &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="n">var</span><span class="p">][</span><span class="s1">&#39;stderr&#39;</span><span class="p">]),</span>
                <span class="n">align</span><span class="o">=</span><span class="s2">&quot;start&quot;</span><span class="p">,</span>
                <span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pn</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatInput</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                    <span class="c1"># Set value to the saved_args (or Ansatz) or to 0</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">saved_args</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">saved_args</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">objs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">watch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_fit_args</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="c1"># Add buttons to model the fit, reset the fit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reguess_fit_button</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Reguess&quot;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">button_type</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reguess_fit_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reguess_fit</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_fit_button</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Save&quot;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">button_type</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_fit_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_fit</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model_fit_button</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Run Fit&quot;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">button_type</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_fit_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fit</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">refit_button</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Refit&quot;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">button_type</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refit_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_fit_box</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fitted</span><span class="p">:</span>
            <span class="n">objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pn</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_fit_button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit_button</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pn</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fit_button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reguess_fit_button</span><span class="p">))</span>
        <span class="c1"># Add to the layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_inputs</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">WidgetBox</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">selected</span><span class="p">,</span>
                                       <span class="n">objects</span><span class="o">=</span><span class="n">objs</span>
                                       <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_layout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pn</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span><span class="n">objects</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_inputs</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;fit_box&quot;</span><span class="p">))</span>

        <span class="c1"># Save to fit_dict</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;fit_function&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="s1">&#39;start_params&#39;</span><span class="p">:</span> <span class="n">saved_args</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{}}</span>
        <span class="c1"># Resave to json for case of new fit class</span>
        <span class="k">elif</span> <span class="s1">&#39;start_params&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span><span class="p">][</span><span class="s1">&#39;start_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">saved_args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span><span class="p">][</span><span class="s1">&#39;fit_function&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="o">.</span><span class="n">clicked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_fit_args</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_inputs</span></div>


<div class="viewcode-block" id="PlotNode.save_fit">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.save_fit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">events</span><span class="p">:</span> <span class="n">param</span><span class="o">.</span><span class="n">parameterized</span><span class="o">.</span><span class="n">Event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves only the currently selected fit axis to the json file&quot;&quot;&quot;</span>
        <span class="n">params_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_result</span><span class="o">.</span><span class="n">params_to_dict</span><span class="p">()</span>
        <span class="n">params_path</span> <span class="o">=</span> <span class="n">add_end_number_to_repeated_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;fit_params.json&quot;</span><span class="p">))</span>

        <span class="n">fit_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_result</span><span class="o">.</span><span class="n">lmfit_result</span><span class="o">.</span><span class="n">fit_report</span><span class="p">()</span>
        <span class="n">result_path</span> <span class="o">=</span> <span class="n">add_end_number_to_repeated_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;fit_result.txt&quot;</span><span class="p">))</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">params_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">params_dict</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NumpyEncoder</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">result_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fit_result</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotNode.reguess_fit">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.reguess_fit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">reguess_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resets the current args to the results of the Fit.guess() function for the</span>
<span class="sd">        current fit class.&quot;&quot;&quot;</span>
        <span class="c1"># Save the parameters from the current fit</span>
        <span class="n">store_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="c1"># Redo the box (will add the axis back to fit_dict)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_fit_box_helper</span><span class="p">(</span>
            <span class="kc">True</span><span class="p">,</span> <span class="n">store_params</span><span class="p">[</span><span class="s1">&#39;fit_function&#39;</span><span class="p">])</span>
        <span class="c1"># Restore parameters of current saved fit and refresh graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">store_params</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_graph</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="PlotNode.model_fit">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.model_fit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">model_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">events</span><span class="p">:</span> <span class="n">param</span><span class="o">.</span><span class="n">parameterized</span><span class="o">.</span><span class="n">Event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Models the fit starting with the arguments already created&quot;&quot;&quot;</span>
        <span class="c1"># Get fit class, axis name, coordinate values</span>
        <span class="n">fit_class</span> <span class="o">=</span> <span class="n">PlotNode</span><span class="o">.</span><span class="n">FITS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="o">.</span><span class="n">clicked</span><span class="p">]</span>
        <span class="n">data_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span>
        <span class="n">np_data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="o">.</span><span class="n">coords</span><span class="p">]</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">np_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">coord_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indep_dims</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">coord_dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">np_data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="o">.</span><span class="n">data_vars</span><span class="p">[</span><span class="n">data_key</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="c1"># Run the fit on the fit class</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="n">fit_class</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span>
        <span class="n">run_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span><span class="p">][</span><span class="s1">&#39;start_params&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_result</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">**</span><span class="n">run_kwargs</span><span class="p">)</span>
        <span class="c1"># Get the Fit Result&#39;s arguments</span>
        <span class="n">params_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_result</span><span class="o">.</span><span class="n">params_to_dict</span><span class="p">()</span>
        <span class="n">fit_params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">fit_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="c1"># Update the dataset with the new data</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_dataset_by_fit_and_axis</span><span class="p">(</span><span class="n">fit_class</span><span class="p">,</span> <span class="n">fit_params</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">saved</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_dict</span>
        <span class="c1"># switch to fitted fit_box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_fit_box</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">fitted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_graph</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="PlotNode.get_arguments">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.get_arguments">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets argument values for the currently selected fit and</span>
<span class="sd">        fit axis. Pulls data from the json if one exists, otherwise</span>
<span class="sd">        runs fit.guess and takes those values.&quot;&quot;&quot;</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span>
        <span class="n">fit_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="o">.</span><span class="n">clicked</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;fit_function&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">fit_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ansatz</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotNode.get_ansatz">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.get_ansatz">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_ansatz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fit_class</span> <span class="o">=</span> <span class="n">PlotNode</span><span class="o">.</span><span class="n">FITS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="o">.</span><span class="n">clicked</span><span class="p">]</span>
        <span class="c1"># Get the guess for this data and x</span>
        <span class="c1"># Set data_key to first data key &amp; make numpy data</span>
        <span class="n">data_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span>
        <span class="n">np_data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="o">.</span><span class="n">coords</span><span class="p">]</span>
        <span class="c1"># Get Ansatz using fit&#39;s &#39;guess&#39; function</span>
        <span class="n">coord_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indep_dims</span><span class="p">()</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">np_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">coord_dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">np_data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">fit_class</span><span class="o">.</span><span class="n">guess</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="o">.</span><span class="n">data_vars</span><span class="p">[</span><span class="n">data_key</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span></div>


<div class="viewcode-block" id="PlotNode.update_fit_args">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.update_fit_args">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_fit_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the temporary saved value for all of the fit&#39;s starting arguments.</span>

<span class="sd">        Called whenever a float input&#39;s value is changed, when the fitbox is </span>
<span class="sd">        created, or when the fit_axis changes. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;fit_function&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="s1">&#39;start_params&#39;</span><span class="p">:</span> <span class="p">{}}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_inputs</span><span class="o">.</span><span class="n">objects</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pn</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatInput</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span><span class="p">][</span><span class="s1">&#39;start_params&#39;</span><span class="p">][</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_inputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

        <span class="n">fit_class</span> <span class="o">=</span> <span class="n">PlotNode</span><span class="o">.</span><span class="n">FITS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_button</span><span class="o">.</span><span class="n">clicked</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span><span class="p">][</span><span class="s1">&#39;start_params&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_dataset_by_fit_and_axis</span><span class="p">(</span><span class="n">fit_class</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_fit_axis</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_graph</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="PlotNode.update_dataset_by_fit_and_axis">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.update_dataset_by_fit_and_axis">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_dataset_by_fit_and_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit_class</span><span class="p">:</span> <span class="n">Fit</span><span class="p">,</span>
                                       <span class="n">model_args</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
                                       <span class="n">model_axis_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">saved</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the data for fit in the self.data_out dataset based</span>
<span class="sd">        on the given arguments.&quot;&quot;&quot;</span>
        <span class="c1"># Create np array of coordinates</span>
        <span class="n">np_data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="o">.</span><span class="n">coords</span><span class="p">]</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">np_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">coord_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indep_dims</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">coord_dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">np_data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1"># Model the data, name it, and add to self.data_out</span>
        <span class="n">fit_data</span> <span class="o">=</span> <span class="n">fit_class</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="o">**</span><span class="n">model_args</span><span class="p">)</span>
        <span class="n">fit_name</span> <span class="o">=</span> <span class="n">model_axis_name</span><span class="o">+</span><span class="s2">&quot;_fit&quot;</span>
        <span class="n">fit_name_temp</span> <span class="o">=</span> <span class="n">model_axis_name</span><span class="o">+</span><span class="s2">&quot;_fit*&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">saved</span><span class="p">:</span>
            <span class="c1"># If not saved, deleted save data and add * to name</span>
            <span class="k">if</span> <span class="n">fit_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="n">fit_name</span><span class="p">]</span>
            <span class="n">fit_name</span> <span class="o">=</span> <span class="n">fit_name_temp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If saved, delete unsaved data</span>
            <span class="k">if</span> <span class="n">fit_name_temp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="n">fit_name_temp</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_dataset_by_data</span><span class="p">(</span><span class="n">fit_data</span><span class="p">,</span> <span class="n">fit_name</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="PlotNode.update_dataset_by_data">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.update_dataset_by_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_dataset_by_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit_data</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
        <span class="c1"># Get independent variable(s) and fit class</span>
        <span class="n">indep</span><span class="p">,</span> <span class="n">dep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">indep</span><span class="p">,</span> <span class="n">fit_data</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotNode.get_data_fit_names">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.get_data_fit_names">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_data_fit_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis_name</span><span class="p">,</span> <span class="n">omit_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">omit_axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">omit_axes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Magnitude&#39;</span><span class="p">,</span> <span class="s1">&#39;Phase&#39;</span><span class="p">]</span>

        <span class="c1"># Check if a fit axis exists. Return list of axis and fit axis (if it exists)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis_name</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1"># If given name is a list, loop through all names in list</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">axis_name</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_fit_names</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ret</span>
        <span class="c1"># axis_name is a string:</span>
        <span class="c1"># Omit axis based on passed omissions</span>
        <span class="k">if</span> <span class="n">axis_name</span> <span class="ow">in</span> <span class="n">omit_axes</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="c1"># Check if a _fit or _fit* version of the name exists</span>
        <span class="n">fit_name</span> <span class="o">=</span> <span class="n">axis_name</span> <span class="o">+</span> <span class="s2">&quot;_fit&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[</span><span class="n">axis_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">fit_name</span><span class="o">+</span><span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_name</span><span class="o">+</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fit_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="PlotNode.get_values">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.get_values">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets a dictionary of values from the result of the FitResult&#39;s params_to_dict() function.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;params&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;start_params&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;start_params&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_dict</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_dict</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">values</span></div>

    
<div class="viewcode-block" id="PlotNode.indep_dims">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.PlotNode.indep_dims">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">indep_dims</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">indep</span><span class="p">,</span> <span class="n">dep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indep</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">indep</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">indep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="mi">0</span></div>
</div>



<div class="viewcode-block" id="ValuePlot">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.ValuePlot">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ValuePlot</span><span class="p">(</span><span class="n">PlotNode</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xy_select</span> <span class="o">=</span> <span class="n">XYSelect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_old_indep</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_options_panel</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_panel</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__panel__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span>

<div class="viewcode-block" id="ValuePlot.plot_options_panel">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.ValuePlot.plot_options_panel">[docs]</a>
    <span class="nd">@pn</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;data_out&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_options_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">indep</span><span class="p">,</span> <span class="n">dep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;None&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">indep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">opts</span> <span class="o">+=</span> <span class="n">indep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xy_select</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">opts</span>

        <span class="k">if</span> <span class="n">indep</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_old_indep</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xy_select</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">opts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xy_select</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;None&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_old_indep</span> <span class="o">=</span> <span class="n">indep</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy_select</span></div>


<div class="viewcode-block" id="ValuePlot.plot_panel">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.ValuePlot.plot_panel">[docs]</a>
    <span class="nd">@pn</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;data_out&quot;</span><span class="p">,</span> <span class="s2">&quot;xy_select.value&quot;</span><span class="p">,</span> <span class="s2">&quot;refresh_graph&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_graph</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">plot</span> <span class="o">=</span> <span class="s2">&quot;*No valid options chosen.*&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy_select</span><span class="o">.</span><span class="n">value</span>

        <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
            <span class="k">pass</span>

        <span class="c1"># case: a line or scatter plot (or multiple of these)</span>
        <span class="k">elif</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="n">plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                    <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_fit_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_axis_options</span><span class="p">()),</span>
                <span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
                <span class="n">plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                    <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_fit_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_axis_options</span><span class="p">()),</span>
                <span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span>

        <span class="c1"># case: if x and y are selected, we make a 2d plot of some sort</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="n">plot</span> <span class="o">=</span> <span class="n">plot_df_as_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                                     <span class="n">dim_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_labels</span><span class="p">(),</span>
                                     <span class="n">graph_axes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_fit_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_axis_options</span><span class="p">())</span>
                                     <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
                <span class="n">plot</span> <span class="o">=</span> <span class="n">plot_xr_as_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                                     <span class="n">dim_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_labels</span><span class="p">(),</span>
                                     <span class="n">graph_axes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_fit_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_axis_options</span><span class="p">())</span>
                                     <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">cols</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plot</span></div>


<div class="viewcode-block" id="ValuePlot.fit_axis_options">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.ValuePlot.fit_axis_options">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit_axis_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">indep</span><span class="p">,</span> <span class="n">dep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dep</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">!=</span> <span class="s2">&quot;_fit&quot;</span> <span class="ow">and</span> <span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span> <span class="o">!=</span> <span class="s2">&quot;_fit*&quot;</span><span class="p">:</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span></div>
</div>

    

<div class="viewcode-block" id="ComplexHist">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.ComplexHist">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ComplexHist</span><span class="p">(</span><span class="n">PlotNode</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gb_select</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">CheckButtonGroup</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Group by&quot;</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">value</span><span class="o">=</span><span class="p">[],</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
            <span class="n">labeled_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gb_select</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_panel</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__panel__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span>

    <span class="nd">@pn</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;data_out&quot;</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_sync_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">indep</span><span class="p">,</span> <span class="n">dep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indep</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gb_select</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">indep</span>

<div class="viewcode-block" id="ComplexHist.plot_panel">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.ComplexHist.plot_panel">[docs]</a>
    <span class="nd">@pn</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;data_out&quot;</span><span class="p">,</span> <span class="s2">&quot;gb_select.value&quot;</span><span class="p">,</span> <span class="s2">&quot;refresh_graph&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_graph</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

        <span class="n">plot</span> <span class="o">=</span> <span class="s2">&quot;*No valid options chosen.*&quot;</span>

        <span class="n">layout</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Column</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">complex_dependents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">xlim</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;imag&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;imag&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span>
                <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hexbin&quot;</span><span class="p">,</span>
                <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">groupby</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gb_select</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">],</span>
                <span class="n">y</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;imag&quot;</span><span class="p">],</span>
                <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
                <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
                <span class="n">clabel</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="n">layout</span>

        <span class="k">return</span> <span class="n">plot</span></div>


<div class="viewcode-block" id="ComplexHist.get_plot">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.ComplexHist.get_plot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">plt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_panel</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">plt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">object</span></div>


<div class="viewcode-block" id="ComplexHist.fit_axis_options">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.ComplexHist.fit_axis_options">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit_axis_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">complex_dependents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>
</div>



<div class="viewcode-block" id="MagnitudePhasePlot">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.MagnitudePhasePlot">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MagnitudePhasePlot</span><span class="p">(</span><span class="n">PlotNode</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xy_select</span> <span class="o">=</span> <span class="n">XYSelect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_old_indep</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_options_panel</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_panel</span><span class="p">,</span>
        <span class="p">)</span>

<div class="viewcode-block" id="MagnitudePhasePlot.process">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.MagnitudePhasePlot.process">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">),</span> <span class="s2">&quot;MagnitudePhasePlot needs an xr.Dataset, did not receive one.&quot;</span>
        <span class="c1"># Convert the current dataset to one that has Magnitude and Phase columns</span>
        <span class="n">indep</span><span class="p">,</span> <span class="n">dep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="p">)</span>
        <span class="c1"># Assign labels. This assumes the first column is the real coefficients.</span>
        <span class="n">keylist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">real</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">keylist</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">imaginary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">keylist</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="c1"># Calculate magnitude and phase</span>
        <span class="n">magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">real</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">imaginary</span><span class="p">))</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">imaginary</span> <span class="o">/</span> <span class="n">real</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
        <span class="c1"># Add magnitude and phase data (don&#39;t effect self.data_in)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="s1">&#39;Magnitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">indep</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="s1">&#39;Phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">indep</span><span class="p">,</span> <span class="n">phase</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">__panel__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span>

<div class="viewcode-block" id="MagnitudePhasePlot.plot_options_panel">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.MagnitudePhasePlot.plot_options_panel">[docs]</a>
    <span class="nd">@pn</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;data_out&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_options_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">indep</span><span class="p">,</span> <span class="n">dep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;None&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">indep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">opts</span> <span class="o">+=</span> <span class="n">indep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xy_select</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">opts</span>

        <span class="k">if</span> <span class="n">indep</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_old_indep</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xy_select</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">opts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xy_select</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;None&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_old_indep</span> <span class="o">=</span> <span class="n">indep</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy_select</span></div>


<div class="viewcode-block" id="MagnitudePhasePlot.plot_panel">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.MagnitudePhasePlot.plot_panel">[docs]</a>
    <span class="nd">@pn</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;data_out&quot;</span><span class="p">,</span> <span class="s2">&quot;xy_select.value&quot;</span><span class="p">,</span> <span class="s2">&quot;refresh_graph&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_graph</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">plot</span> <span class="o">=</span> <span class="s2">&quot;*No valid options chosen.*&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy_select</span><span class="o">.</span><span class="n">value</span>

        <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
            <span class="k">pass</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># case: a line or scatter plot (or multiple of these)</span>
            <span class="c1"># NOTE: if these have shared_axes=True, then both graphs cannot</span>
            <span class="c1"># simultaneously have fits without one graph being unreadable due to</span>
            <span class="c1"># it&#39;s axis dimensions.</span>
            <span class="k">if</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
                <span class="n">plot_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                    <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_fit_names</span><span class="p">(</span><span class="s2">&quot;Magnitude&quot;</span><span class="p">),</span>
                    <span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">plot_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_label</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                    <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_fit_names</span><span class="p">(</span><span class="s2">&quot;Phase&quot;</span><span class="p">),</span>
                    <span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">plot</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">plot_m</span><span class="p">,</span> <span class="n">plot_p</span><span class="p">)</span>

            <span class="c1"># case: if x and y are selected, we make a 2d plot of some sort</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plot</span> <span class="o">=</span> <span class="n">plot_xr_as_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                                     <span class="n">dim_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_labels</span><span class="p">(),</span> 
                                     <span class="n">graph_axes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_fit_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_axis_options</span><span class="p">()))</span>
                <span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">cols</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">plot</span></div>


<div class="viewcode-block" id="MagnitudePhasePlot.fit_axis_options">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.MagnitudePhasePlot.fit_axis_options">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit_axis_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;Magnitude&#39;</span><span class="p">,</span> <span class="s1">&#39;Phase&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="MagnitudePhasePlot.get_data_fit_names">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.MagnitudePhasePlot.get_data_fit_names">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_data_fit_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis_name</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_data_fit_names</span><span class="p">(</span><span class="n">axis_name</span><span class="p">,</span> <span class="p">[])</span></div>
</div>



<div class="viewcode-block" id="plot_df_as_2d">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.plot_df_as_2d">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_df_as_2d</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dim_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">graph_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">graph_axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">graph_axes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">dim_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dim_labels</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">indeps</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="n">Node</span><span class="o">.</span><span class="n">data_dims</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="c1"># Set deps to the passed axes so it graphs all desired data</span>
    <span class="k">if</span> <span class="n">graph_axes</span> <span class="o">!=</span> <span class="p">[]:</span>
        <span class="n">deps</span> <span class="o">=</span> <span class="n">graph_axes</span>

    <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">indeps</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">indeps</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
            <span class="o">*</span><span class="p">[</span>
                <span class="n">df</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                    <span class="n">C</span><span class="o">=</span><span class="n">d</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="n">dim_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span>
                    <span class="n">ylabel</span><span class="o">=</span><span class="n">dim_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
                    <span class="n">clabel</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mean </span><span class="si">{</span><span class="n">dim_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">deps</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">deps</span> <span class="o">+</span> <span class="n">indeps</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">deps</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">dim_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="n">dim_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;*that&#39;s currently not supported :(*&quot;</span></div>



<div class="viewcode-block" id="plot_xr_as_2d">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.plot_xr_as_2d">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_xr_as_2d</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dim_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">graph_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">graph_axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">graph_axes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">dim_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dim_labels</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">ds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Nothing to plot.&quot;</span>

    <span class="n">indeps</span><span class="p">,</span> <span class="n">deps</span> <span class="o">=</span> <span class="n">Node</span><span class="o">.</span><span class="n">data_dims</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Set deps to the passed axes so it graphs all desired data</span>
    <span class="k">if</span> <span class="n">graph_axes</span><span class="p">:</span>
        <span class="n">deps</span> <span class="o">=</span> <span class="n">graph_axes</span>

    <span class="k">if</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;_fit&#39;</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">plot_ds_2d_with_fit</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">dim_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="c1"># plotting stuff vs two independent -- heatmap</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">indeps</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">indeps</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">deps</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plot</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">quadmesh</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="n">dim_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span>
                    <span class="n">ylabel</span><span class="o">=</span><span class="n">dim_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
                    <span class="n">clabel</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mean </span><span class="si">{</span><span class="n">dim_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plot</span> <span class="o">+=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">quadmesh</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="n">dim_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span>
                    <span class="n">ylabel</span><span class="o">=</span><span class="n">dim_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
                    <span class="n">clabel</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mean </span><span class="si">{</span><span class="n">dim_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="c1"># FIXME: QuadMesh object has no attribute &#39;cols&#39; error for longsweep</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">plot</span><span class="o">.</span><span class="n">cols</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;*Not a valid plot* Attribute Error occurred&quot;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;*Not a valid plot*&quot;</span></div>



<span class="c1"># -- specific plot functions</span>


<span class="c1"># -- various tool functions</span>


<div class="viewcode-block" id="labeled_widget">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.labeled_widget">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">labeled_widget</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">margin</span>

    <span class="k">if</span> <span class="n">lbl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lbl</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">name</span>

    <span class="n">lbl_w</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">w</span><span class="o">.</span><span class="n">margin</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
        <span class="n">lbl_w</span><span class="p">,</span>
        <span class="n">w</span><span class="p">,</span>
    <span class="p">)</span></div>



<span class="c1"># -- convenience functions</span>


<div class="viewcode-block" id="plot_data">
<a class="viewcode-back" href="../../../api/generated/labcore.analysis.hvplotting.html#labcore.analysis.hvplotting.plot_data">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_data</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">viewable</span><span class="o">.</span><span class="n">Viewable</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;plot&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
        <span class="n">n</span><span class="p">,</span>
        <span class="n">n</span><span class="o">.</span><span class="n">plot</span><span class="p">,</span>
    <span class="p">)</span></div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
       Copyright 2025-2026, Marcos Frenkel, Wolfgang Pfaff, Cynthia Nolan.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__center">
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>